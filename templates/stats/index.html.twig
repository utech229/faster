{% extends 'base.app.html.twig' %}

{% block title %}{{"Statistiques SMS"|trans}} - {{brand.name}}{% endblock %}

{% block body %}
<!--begin::Post-->
<div class="post d-flex flex-column-fluid" id="kt_post">
	<!--begin::Container-->
	<div id="kt_content_container" class="container-xxl">
		<!--begin::Toolbar-->
		<!--begin::Card-->
		<div class="card card-flush mb-5">
			<div class="card-body row pt-5">
				<!--begin::Col-->
				<div class="col-md-12 mt-5">
					<!--begin::Col header-->
					<span class="fs-6 text-gray-400 fw-bold ms-1" id="info_periode"></span>
					<!--end::Col header-->
				</div>
				<!--end::Col-->
				<!--begin::Col-->
				<div class="col-md-3 mt-0">
					<!--begin::Col header-->
					<div class="mb-2">
						<div class="d-flex flex-stack mb-2 px-2">
							<div class="fw-bolder fs-4">{{"Programmées"|trans}}
							<span class="text-gray-400 ms-2" id="count_programming">0</span></div>
							<!--begin::Menu-->
							{# <div class="fs-8">
								<span class="ms-2" id="amount_programming">0</span><span class="ms-2" id="amount-currency">XOF</span>
							</div> #}
							<!--end::Menu-->
						</div>
						<div class="h-3px w-100 bg-primary"></div>
					</div>
					<!--end::Col header-->
				</div>
				<!--end::Col-->
				<!--begin::Col-->
				<div class="col-md-3 mt-0">
					<!--begin::Col header-->
					<div class="mb-2">
						<div class="d-flex flex-stack mb-2 px-2">
							<div class="fw-bolder fs-4">{{"En cours"|trans}}
							<span class="text-gray-400 ms-2" id="count_in_progress">0</span></div>
							<!--begin::Menu-->
							{# <div class="fs-8">
								<span class="ms-2" id="amount_in_progress">0</span><span class="ms-2" id="amount-currency">XOF</span>
							</div> #}
							<!--end::Menu-->
						</div>
						<div class="h-3px w-100 bg-warning"></div>
					</div>
					<!--end::Col header-->
				</div>
				<!--end::Col-->
				<!--begin::Col-->
				<div class="col-md-3 mt-0">
					<!--begin::Col header-->
					<div class="mb-2">
						<div class="d-flex flex-stack mb-2 px-2">
							<div class="fw-bolder fs-4">{{"Rejetés"|trans}}
							<span class="text-gray-400 ms-2" id="count_invalid">0</span></div>
							<!--begin::Menu-->
							{# <div class="fs-8">
								<span class="ms-2" id="amount_invalid">0</span><span class="ms-2" id="amount-currency">XOF</span>
							</div> #}
							<!--end::Menu-->
						</div>
						<div class="h-3px w-100 bg-danger"></div>
					</div>
					<!--end::Col header-->
				</div>
				<!--end::Col-->
				<!--begin::Col-->
				<div class="col-md-3 mt-0">
					<!--begin::Col header-->
					<div class="mb-2">
						<div class="d-flex flex-stack mb-2 px-2">
							<div class="fw-bolder fs-4">{{"Délivrés"|trans}}
							<span class="text-gray-400 ms-2" id="count_delivered">0</span></div>
							<!--begin::Menu-->
							{# <div class="fs-8">
								<span class="ms-2" id="amount_delivered">0</span><span class="ms-2" id="amount-currency">XOF</span>
							</div> #}
							<!--end::Menu-->
						</div>
						<div class="h-3px w-100 bg-success"></div>
					</div>
					<!--end::Col header-->
				</div>
				<!--end::Col-->
			</div>
		</div>
		<!--end::Card-->
		<!--begin::Card-->
		<div class="card card-flush">
			<!--begin::Card header-->
			<div class="card-header">
				<!--begin::Card title-->
				<div class="card-title">
					<!--begin::Search-->
					<div class="d-flex align-items-center position-relative my-1 me-5">
						<!--begin::Filter-->
						<button type="button" class="btn btn-light-primary me-3" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-start">
							<!--begin::Svg Icon | path: icons/duotune/general/gen031.svg-->
							<span class="svg-icon svg-icon-2">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
									<path d="M19.0759 3H4.72777C3.95892 3 3.47768 3.83148 3.86067 4.49814L8.56967 12.6949C9.17923 13.7559 9.5 14.9582 9.5 16.1819V19.5072C9.5 20.2189 10.2223 20.7028 10.8805 20.432L13.8805 19.1977C14.2553 19.0435 14.5 18.6783 14.5 18.273V13.8372C14.5 12.8089 14.8171 11.8056 15.408 10.964L19.8943 4.57465C20.3596 3.912 19.8856 3 19.0759 3Z" fill="currentColor" />
								</svg>
							</span>
							<!--end::Svg Icon-->{{ 'Filtre' | trans }}
						</button>
						<!--begin::Menu 1-->
						<div class="menu menu-sub menu-sub-dropdown w-400px w-md-425px" data-kt-menu="true" id="menu-filter">
							<!--begin::Header-->
							<div class="px-7 pt-3 pb-2">
								<div class="fs-5 text-dark fw-bolder">{{ 'Options de filtre' | trans }}</div>
							</div>
							<!--end::Header-->
							<!--begin::Separator-->
							<div class="separator border-gray-200"></div>
							<!--end::Separator-->
							<!--begin::Content-->
							<div class="px-7 py-2">
								<!--begin::Input group-->
								<div class="mb-3 {% if userType > 3 %}sr-only{% endif %}">
									<label class="form-label fs-6 fw-bold">{{ 'Marque' | trans }} :</label>
									<select class="form-select form-select-solid fw-bolder" data-kt-select2="true" data-placeholder="{{"Choisissez la marque"}}" data-allow-clear="true" id="brand">
										<option value="">{{"Toutes"|trans}}</option>
										{% for brand in brands %}
											<option value="{{ brand.uid }}" data-select2-avatar="{{asset('app/uploads/brands/logos/' ~ brand.logo)}}" data-select2-alt="{{brand.name}}">{{ brand.name }}</option>
										{% endfor %}
									</select>
								</div>
								<!--end::Input group-->
								<!--begin::Input group-->
								<div class="mb-3 {% if userType > 3 %}sr-only{% endif %}">
									<label class="form-label fs-6 fw-bold">{{ 'Utilisateur' | trans }} :</label>
									<select class="form-select form-select-solid fw-bolder" data-kt-select2="true" data-placeholder="{{"Choisissez l'utilisateur"}}" data-allow-clear="true" id="user">
										{% for user in users %}
											<option value="{{ user.uid }}">{{ user.email }}</option>
										{% endfor %}
									</select>
								</div>
								<!--end::Input group-->
								<!--begin::Input group-->
								<div class="mb-3">
									<label class="form-label fs-6 fw-bold">{{ 'Expéditeur' | trans }} :</label>
									<select class="form-select form-select-solid fw-bolder" data-kt-select2="true" data-placeholder="{{"Choisissez l'expéditeur"}}" data-allow-clear="true" id="sender">
									</select>
								</div>
								<!--end::Input group-->
								<!--begin::Input group-->
								<div class="mb-3 row">
									<div class="col-6">
										<label class="form-label fs-6 fw-bold">{% trans %}Statut{% endtrans %} :</label>
										<select id="status" data-kt-select2="true" data-allow-clear="true" data-hide-search="true" class="form-select form-select-solid fw-bolder" data-placeholder="{{'Statut des messages' | trans}}">
											{# data-allow-clear="true" data-control="select2"  #}
											<option value="">{{"Tous"|trans}}</option>
											{% for oneStatus in status %}
												<option value="{{ oneStatus.uid }}">{{ oneStatus.name }}</option>
											{% endfor %}
										</select>
									</div>
									<div class="col-6">
										<label class="form-label fs-6 fw-bold">{% trans %}Période{% endtrans %} :</label>
										<select id="periode" data-kt-select2="true" data-allow-clear="true" data-hide-search="true" class="form-select form-select-solid fw-bolder" data-placeholder="{{'Période de données' | trans}}">
											{#  data-allow-clear="true" data-control="select2"  #}
											<option value="1w">{{"1 semaine"|trans}}</option>
											<option value="1m">{{"1 mois"|trans}}</option>
											<option value="3m">{{"3 mois"|trans}}</option>
										</select>
									</div>
								</div>
								<!--end::Input group-->
								<!--begin::Actions-->
								<div class="d-flex justify-content-end">
									<button type="button" class="btn btn-light btn-active-light-primary fw-bold me-2 px-6" data-kt-menu-dismiss="true" id="reset">{{"Remise à zéro"|trans}}</button>
									<button type="submit" class="btn btn-primary fw-bold px-6" data-kt-menu-dismiss="true" id="submit">{{"Appliquer"|trans}}</button>
								</div>
								<!--end::Actions-->
							</div>
							<!--end::Content-->
						</div>
						<!--end::Menu 1-->
						<!--end::Filter-->
					</div>
					<!--end::Search-->
				</div>
				<!--end::Card title-->
				<!--begin::Card toolbar-->
				<div class="card-toolbar">
					<!--begin::Controls Pane-->
					<div class="d-flex flex-wrap my-1">
						<!--begin::Tab nav-->
						<ul class="nav nav-pills">
							<li class="nav-item m-0">
								<a class="btn btn-sm btn-icon btn-light btn-color-muted btn-active-primary active me-3" data-bs-toggle="tab" href="#targets_table_pane">
									<!--begin::Svg Icon | path: icons/duotune/abstract/abs015.svg-->
									<span class="svg-icon svg-icon-2">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
											<path d="M21 7H3C2.4 7 2 6.6 2 6V4C2 3.4 2.4 3 3 3H21C21.6 3 22 3.4 22 4V6C22 6.6 21.6 7 21 7Z" fill="currentColor" />
											<path opacity="0.3" d="M21 14H3C2.4 14 2 13.6 2 13V11C2 10.4 2.4 10 3 10H21C21.6 10 22 10.4 22 11V13C22 13.6 21.6 14 21 14ZM22 20V18C22 17.4 21.6 17 21 17H3C2.4 17 2 17.4 2 18V20C2 20.6 2.4 21 3 21H21C21.6 21 22 20.6 22 20Z" fill="currentColor" />
										</svg>
									</span>
									<!--end::Svg Icon-->
								</a>
							</li>
							<li class="nav-item m-0">
								<a id="graphs" class="btn btn-sm btn-icon btn-light btn-color-muted btn-active-primary" data-bs-toggle="tab" href="#targets_card_pane">
									<!--begin::Svg Icon | path: assets/media/icons/duotune/graphs/gra001.svg-->
									<span class="svg-icon svg-icon-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
									<path opacity="0.3" d="M14 3V21H10V3C10 2.4 10.4 2 11 2H13C13.6 2 14 2.4 14 3ZM7 14H5C4.4 14 4 14.4 4 15V21H8V15C8 14.4 7.6 14 7 14Z" fill="currentColor"/>
									<path d="M21 20H20V8C20 7.4 19.6 7 19 7H17C16.4 7 16 7.4 16 8V20H3C2.4 20 2 20.4 2 21C2 21.6 2.4 22 3 22H21C21.6 22 22 21.6 22 21C22 20.4 21.6 20 21 20Z" fill="currentColor"/>
									</svg></span>
									<!--end::Svg Icon-->
								</a>
							</li>
						</ul>
						<!--end::Tab nav-->
					</div>
					<!--end::Controls Pane-->
				</div>
				<!--end::Card toolbar-->
			</div>
			<!--end::Card header-->
			<!--begin::Card body-->
			<div class="card-body pt-0 row">
				<div class="tab-content">
					<div id="targets_table_pane" class="tab-pane fade show active">
						<!--begin::Table-->
						<table id="Stats_table" class="table table-row-bordered table-row-dashed gy-4 align-middle">
							<!--begin::Table head-->
							<thead class="fs-7 text-gray-400 text-uppercase text-center">
								<tr>
									<th class="min-w-100px">{{"Téléphone"|trans}}</th>
									<th class="min-w-100px">{{"Expéditeur"|trans}}</th>
									<th class="min-w-100px">{{"Date d'envoi"|trans}}</th>
									<th class="min-w-100px">{{"Statut"|trans}}</th>
									<th class="min-w-100px">{{"Nbr. de page"|trans}}</th>
									<th class="min-w-100px">{{"Infos"|trans}}</th>
									<th class="min-w-100px">{{"Source"|trans}}</th>
									<th class="min-w-100px">{{"Message"|trans}}</th>
									<th class="min-w-100px">{{"Créé le"|trans}}</th>
								</tr>
							</thead>
							<!--end::Table head-->
							<!--begin::Table body-->
							<tbody class="fs-6">
							</tbody>
							<!--end::Table body-->
						</table>
						<!--end::Table-->
					</div>
					<div id="targets_card_pane" class="tab-pane fade row">
						<div class="col-md-12">
							<canvas id='graph1' class='mh-400px'></canvas>
						</div>
						<div class="col-md-12 mt-15 row">
							<div class="col-md-6 mx-0 p-5">
								<canvas id='graph2' class='mh-400px p-10 border'></canvas>
							</div>
							<div class="col-md-6 mx-0 p-5">
								<canvas id='graph3' class='mh-400px p-10 border'></canvas>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--end::Card body-->
		</div>
		<!--end::Card-->
		<!--end::Toolbar-->
	</div>
	<!--end::Container-->
</div>
<!--end::Post-->
{% endblock %}

{% block javascripts %}
<script type="text/javascript">
	const url_user		= "{{path('filter_user')}}",
	url_sender_names	= "{{path('filter_sender_names')}}",
	url_sender			= "{{path('filter_sender')}}",
	url_getList			= "{{path("message_sms_stats_get")}}",
	url_getGraph		= "{{path("message_sms_stats_get")}}",
	_token				= "{{csrf_token("message")}}";

	const spinner ="{{asset('app/media/loading/loading.gif')}}";

	const filter_token	= "{{csrf_token("")}}";

	const labelProgramming	= "{{"SMS programmés"|trans|upper}}",
	labelDelivred			= "{{"SMS délivrés"|trans|upper}}",
	labelAvailabled			= "{{"SMS rejetés"|trans|upper}}",
	labelSending			= "{{"SMS en cours"|trans|upper}}";

	const labelAPI	= "{{"SMS API"|trans|upper}}",
	labelSMS		= "{{"SMS"|trans|upper}}",
	labelCampaign	= "{{"SMS Campagne"|trans|upper}}";

	var defaultSenders = {}

	{% for brand in brands %}
		defaultSenders["{{ brand.uid }}"] = {uid: "{{brand.defaultSender.uid}}", name: "{{brand.defaultSender.name}}"}
	{% endfor %}

	var dataUsers = [{id:'', text:''}];
	{% for user in users %}
		dataUsers.push({id:"{{user.uid}}", text:"{{user.email}}"})
	{% endfor %}

	var dataSenders = [{id:'', text:''}];
	{% for sender in senders %}
		dataSenders.push({id:"{{sender.uid}}", text:"{{sender.name}}"})
	{% endfor %}

	const brandInit = {% if brands|length == 1 %} "{{brands[0].uid}}" {% else %} false {% endif %},
	userInit = {% if users|length == 1 %} "{{users[0].uid}}" {% else %} false {% endif %},
	senderInit = {% if senders|length == 1 %} "{{senders[0].uid}}" {% else %} false {% endif %};
</script>
<script type="text/javascript" src="{{ asset('app/js/queries/sms/statistiques_list.js')}}"></script>
{% endblock %}
